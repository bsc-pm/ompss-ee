CC	= allmcc
CFLAGS	= --ompss -O3 --instrument


# Intermediate files generated by the compiler (which are not removed when using -k flag)
COMP_FILES = $(CC)_*.*


OBJECTS = driver.o check.o gendat.o prtspeed.o cclock.o matmul.o


#link everything together
matmul: $(OBJECTS)
	$(CC) $(CFLAGS) -o matmul $(OBJECTS) $(LDFLAGS)

#compile host code (c)
driver.o: driver.c driver.h
	$(CC) $(CFLAGS) $(CUDAINC) -c driver.c

#compile host code (c)
check.o: check.c driver.h
	$(CC) $(CFLAGS) -c check.c

#compile host code (c)
gendat.o: gendat.c driver.h
	$(CC) $(CFLAGS) -c gendat.c

#compile host code (c)
prtspeed.o: prtspeed.c
	$(CC) $(CFLAGS) -c prtspeed.c

#compile host code (c)
cclock.o: cclock.c
	$(CC) $(CFLAGS) -c cclock.c

#compile host code (c) and opencl code
matmul.o: matmul.c driver.h matmul_kernel.cl matmul_kernel.clh
	$(CC) $(CFLAGS) $(CUDAINC) -c matmul.c matmul_kernel.cl $(NVFLAGS)

clean   :
	rm -f $(OBJECTS) $(COMP_FILES) matmul

wipe: clean
	$(RM) *.out *.err
	$(RM) *.prv *.row *.pcf
	$(RM) graph.dot graph.pdf
